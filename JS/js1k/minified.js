K="width";W=a[K];H=a.height;X=a.addEventListener;V=a.removeEventListener;w=200;h=80;l=[];q=[];o=1.7;v=!0;B=[];J=0;a.style.background="#000";f=10;A=Math.floor;F=Math.abs;MS=Math.sqrt;Mp=Math.pow;P=Math.PI;Q="mousemove";O="mouseup";R="red";G="#0F0";Y="#FF0";p=A(W/w);T=255;zf=0.04;bp=c.beginPath.bind(c);st=c.stroke.bind(c);cp=c.closePath.bind(c);cf=c.fill.bind(c);ca=c.arc.bind(c);L="length";z="layerX";r="layerY";Z="fillStyle";
function I(){for(x=B[L]=0;20>x;x++)for(y=0;8>y;y++)l[x*f][y*f].b||B.push({x:x*f,y:y*f})}function DS(d,b,e,g){for(var k=g.data,m=b*p;m<(b+1)*p;m++)for(var s=d*p;s<(d+1)*p;s++){var n=4*(s+m*g[K]);k[n+0]=e.r;k[n+1]=e.g;k[n+2]=e.b;k[n+3]=e.a}}function DF(d,b,e,g){c.strokeStyle=R;c[Z]=R;d*=p;b*=p;bp();c.moveTo(d,b);c.lineTo(Math.round(d+e*p*w),b+g*p*w);st();bp();ca(d,b,1,0,2*P,!1);st();cp()}function DP(d,b){c[Z]=G;bp();ca(d*p,b*p,1,0,2*P,!1);cf();cp()}
function GC(d,b,e){var g=(b+e)/2,k=F(e-g),m={r:0,g:0,b:0,a:0};d>e&&(d=e);d<b&&(d=b);d>=g?m.r=T:m.g=T;m.a=A(F(d)*(1/k)*T);return m}
function D(){a[K]=W;var d=c.createImageData(W,H);for(x=0;x<w;x++)for(y=0;y<h;y++)if(!l[x][y].b){var b={r:0,g:0,b:0,a:0},e=l[x][y].x,g=l[x][y].y;0==J&&(b=MS(Mp(e,2)+Mp(g,2)),b={r:0,a:A(4E3*b),b:0,g:T},b.g>T&&(b.g=T),0>b.g&&(b.g=0));DS(x,y,b,d)}c.putImageData(d,0,0);x=0;for(ln=B[L];x<ln;x++)DP(B[x].x,B[x].y);if(v)for(x=0;x<w;x+=f)for(y=0;y<h;y+=f)e=l[x][y].x,g=l[x][y].y,DF(x,y,e,g)}
function M(d){if(1===d.which){var b=d[z],e=d[r],g=function(d){var g=d[z];d=d[r];var k=(g-b)/p/f,C=(d-e)/p/f;0.1<F(k)&&(k=0.1*F(k)/k);0.1<F(C)&&(C=0.1*F(C)/C);var N=A(g/p),S=A(d/p);for(x=-5;5>=x;x++)for(y=-5;5>=y;y++)0<=N+x&&N+x<w&&0<=S+y&&S+y<h&&!l[N+x][S+y].b&&5>MS(x*x+y*y)&&q.push([N+x,S+y,k,C]);b=g;e=d},k=function(b){V(Q,g,!1);V(O,k,!1)};X(Q,g,!1);X(O,k,!1)}}X("mousedown",M,!1);ND={0:{x:0,y:0},1:{x:1,y:0},2:{x:0,y:-1},3:{x:-1,y:0},4:{x:0,y:1},5:{x:1,y:-1},6:{x:-1,y:-1},7:{x:-1,y:1},8:{x:1,y:1}};
Rf={0:0,1:3,2:4,3:1,4:2,5:7,6:8,7:5,8:6};function LN(){this.d=[0,0,0,0,0,0,0,0,0];this.s=[0,0,0,0,0,0,0,0,0];this.y=this.x=this.n=0;this.b=!1;this.c=0}function ml(d,b){for(var e=0;e<d;e++){l[e]=[];for(var g=0;g<b;g++)l[e][g]=new LN}}function IF(d,b,e){for(x=0;x<w;x++)for(y=0;y<h;y++){var g=l[x][y];if(!g.b){g.n=e;g.x=d;g.y=b;var k=E(d,b,e);g.d=k.slice(0);g.s=k.slice(0)}}}function MP(){x=0;for(ln=B[L];x<ln;x++){var d=B[x],b=A(d.x),e=A(d.y);0<=b&&b<w&&0<=e&&e<h&&(b=l[b][e],e=b.y,d.x+=b.x,d.y+=e)}}
function IB(d){for(x=0;x<w;x++)for(y=0;y<h;y++)l[x][y].b=!1}function E(d,b,e){var g=[],k=3*b,m=d*d,s=b*b,n=2*d*b,C=m+s;b=1.5*C;var N=1/9*e,S=1/36*e,m=4.5*m-b,s=4.5*s-b,$=1+3*d;d=1-3*d;var aa=4.5*(C+n)-b,n=4.5*(C-n)-b;g[0]=4/9*e*(1-b);g[1]=N*($+m);g[2]=N*(1-k+s);g[3]=N*(d+m);g[4]=N*(1+k+s);g[5]=S*($-k+n);g[6]=S*(d-k+aa);g[7]=S*(d+k+n);g[8]=S*($+k+aa);return g}
function Sz(){for(x=0;x<w;x++)for(y=0;y<h;y++){var d=l[x][y];if(!d.b){0<x&&x<w-1&&0<y&&y<h-1&&(d.c=l[x+1][y].y-l[x-1][y].y-l[x][y+1].x+l[x][y-1].x);for(var b=0;9>b;b++){var e=ND[b],g=e.x+x,e=e.y+y;0<=g&&g<w&&0<=e&&e<h&&(l[g][e].b?l[x][y].s[Rf[b]]=d.d[b]:l[g][e].s[b]=d.d[b])}}}}
function Zz(){for(x=0;x<w;x++)for(y=0;y<h;y++){var d=l[x][y];if(!d.b){for(var b=d.d,e=0;9>e;e++)b[e]=d.s[e];var g=b[1]+b[5]+b[8],k=b[4]+b[7]+b[8],e=b[0]+b[2]+b[3]+b[6]+g+k-b[8],g=(g-b[3]-b[6]-b[7])/e,k=(k-b[2]-b[5]-b[6])/e;d.n=e;d.x=g;d.y=k;e=E(g,k,e);for(k=0;9>k;k++)g=b[k],d.d[k]=g+o*(e[k]-g)}}}function U(){for(var d=0;d<f;d++)for(Sz(),Zz(),0<B[L]&&MP();0<q[L];){u=q.shift();var b=l[u[0]][u[1]];b.d=E(u[2],u[3],b.n)}D();requestAnimationFrame(U)}
function t(){ml(w,h);IB();IF(0,0,1);q[L]=0;I();D();U()}t();