function boltzman(J){function za(b){var d,a;if(void 0!==b){for(a=0;a<D;a++)for(d=0;d<p;d++)E[a*p+d]=0;for(d=0;d<b.length;d++)E[b[d].y*p+b[d].x]=1}else for(a=0;a<D;a++)for(d=0;d<p;d++)if(0===d||d===p-1||0===a||a===D-1||10>Math.abs(p/2-d)&&10>Math.abs(D/2-a))E[a*p+d]=1}function Aa(){var b=la,d=ga,a=V,c=W,f=X,t=Y,A=Z,e=aa,u=ba,l=ca,m,k,v=pa;m=3*v;var g=v*v;k=-0*v;for(var r=g+0,n=1.5*r,v=1*ma*(1-n),x=1*B*(1+m+4.5*g-n),h=1*B*(1-n),g=1*B*(1-m+4.5*g-n),C=1*B*(1-n),q=1*G*(1+m+-0+4.5*(r+k)-n),w=1*G*(1-m+-0+
4.5*(r-k)-n),y=1*G*(1-m- -0+4.5*(r+k)-n),r=1*G*(1+m- -0+4.5*(r-k)-n),n=0;n<p-1;n++)m=n,k=(D-1)*p+n,d[k]=d[m]=v,a[k]=a[m]=x,c[k]=c[m]=h,f[k]=f[m]=g,t[k]=t[m]=C,A[k]=A[m]=q,e[k]=e[m]=w,u[k]=u[m]=y,l[k]=l[m]=r;for(n=0;n<D-1;n++)m=n*p,k=n*p+(p-1),d[k]=d[m]=v,a[k]=a[m]=x,c[k]=c[m]=h,f[k]=f[m]=g,t[k]=t[m]=C,A[k]=A[m]=q,e[k]=e[m]=w,u[k]=u[m]=y,l[k]=l[m]=r;for(d=0;d<b;d++){f=c=a=void 0;t=V;A=W;e=X;u=Y;l=Z;v=aa;x=ba;h=ca;g=p;C=D;for(c=C-2;0<c;c--)for(a=1;a<g-1;a++)f=c*g+a,A[f]=A[(c-1)*g+a],v[f]=v[(c-1)*g+
(a+1)];for(c=C-2;0<c;c--)for(a=g-2;0<a;a--)f=c*g+a,t[f]=t[c*g+(a-1)],l[f]=l[(c-1)*g+(a-1)];for(c=1;c<C-1;c++)for(a=g-2;0<a;a--)f=c*g+a,u[f]=u[(c+1)*g+a],h[f]=h[(c+1)*g+(a-1)];for(c=1;c<C-1;c++)for(a=1;a<g-1;a++)f=c*g+a,e[f]=e[c*g+(a+1)],x[f]=x[(c+1)*g+(a+1)];for(c=1;c<C-1;c++)for(a=1;a<g-1;a++)f=c*g+a,E[f]&&(t[c*g+(a+1)]=e[f],A[(c+1)*g+a]=u[f],e[c*g+(a-1)]=t[f],u[(c-1)*g+a]=A[f],l[(c+1)*g+(a+1)]=x[f],v[(c+1)*g+(a-1)]=h[f],x[(c-1)*g+(a-1)]=l[f],h[(c-1)*g+(a+1)]=v[f]);a=void 0;c=ga;f=V;t=W;A=X;e=Y;
u=Z;l=aa;v=ba;x=ca;h=ha;g=ia;C=ja;q=E;w=qa;y=p;m=D;for(k=1;k<m-1;k++)for(r=1;r<y-1;r++)if(a=k*y+r,!q[a]){var n=c[a],z=f[a],F=t[a],H=A[a],I=e[a],J=u[a],M=l[a],N=v[a],ka=x[a],da=n+z+F+H+I+J+M+N+ka,O=(z+J+ka-H-M-N)/da,K=(I+N+ka-F-J-M)/da;C[a]=da;h[a]=O;g[a]=K;4==Q&&0<r&&r<y-1&&0<k&&k<m-1&&(w[a]=g[k*y+(r+1)]-g[k*y+(r-1)]-h[(k+1)*y+r]+h[(k-1)*y+r]);var ea=3*O,fa=3*K,T=O*O,U=K*K,O=2*O*K,K=T+U,R=1.5*K,na=B*da,oa=G*da;c[a]=n+P*(ma*da*(1-R)-n);f[a]=z+P*(na*(1+ea+4.5*T-R)-z);t[a]=F+P*(na*(1-fa+4.5*U-R)-F);
A[a]=H+P*(na*(1-ea+4.5*T-R)-H);e[a]=I+P*(na*(1+fa+4.5*U-R)-I);u[a]=J+P*(oa*(1+ea-fa+4.5*(K-O)-R)-J);l[a]=M+P*(oa*(1-ea-fa+4.5*(K+O)-R)-M);v[a]=N+P*(oa*(1-ea+fa+4.5*(K-O)-R)-N);x[a]=ka+P*(oa*(1+ea+fa+4.5*(K+O)-R)-ka)}if(0<L.length)for(a=0,c=L.length;a<c;a++)f=L[a],t=Math.floor(f.x),A=Math.floor(f.y),0<=t&&t<p&&0<=A&&A<D&&(e=ia[A*p+t],f.x+=ha[A*p+t],f.y+=e),0<pa&&f.x>p-2&&(f.x=1)}ra();S=requestAnimationFrame(Aa)}function Ba(){e=p*D;ga=new Float64Array(e);V=new Float64Array(e);W=new Float64Array(e);
X=new Float64Array(e);Y=new Float64Array(e);Z=new Float64Array(e);aa=new Float64Array(e);ba=new Float64Array(e);ca=new Float64Array(e);ja=new Float64Array(e);ha=new Float64Array(e);ia=new Float64Array(e);E=new Uint8Array(e);qa=new Float64Array(e);za([]);for(var b=0;b<e;b++)E[b]||(ja[b]=1,ha[b]=0,ia[b]=0,ga[b]=1*ma,V[b]=1*B,W[b]=1*B,X[b]=1*B,Y[b]=1*B,Z[b]=1*G,aa[b]=1*G,ba[b]=1*G,ca[b]=1*G);ra()}function sa(b,d,a){0>a&&(a+=1);1<a&&--a;return a<1/6?b+6*(d-b)*a:.5>a?d:a<2/3?b+(d-b)*(2/3-a)*6:b}function Ca(){for(var b=
0;b<p;b++)for(var d=0;d<D;d++)E[d*p+b]&&(H.beginPath(),H.rect(b*l,d*l,l,l),H.fill(),H.closePath())}function ra(){var b,d;M&&q.clearRect(0,0,w,z);if(0<L.length)for(F.clearRect(0,0,w,z),b=0,d=L.length;b<d;b++){var a=L[b].x,c=L[b].y;F.beginPath();F.arc(a*l,c*l,1,0,2*Math.PI,!1);F.fill();F.closePath()}T&&(H.clearRect(0,0,w,z),Ca(H),T=!1);for(b=0;b<p;b++)for(d=0;d<D;d++)if(a=d*p+b,!E[a]){var c=0,f=ha[a],t=ia[a];if(M&&0===b%10&&0===d%10){var e=f,h=t,u=b*l,B=d*l;q.beginPath();q.moveTo(u,B);q.lineTo(Math.round(u+
e*l*200),B+h*l*200);q.stroke();q.beginPath();q.arc(u,B,1,0,2*Math.PI,!1);q.fill();q.closePath()}if(0===Q)c=parseInt((Math.sqrt(Math.pow(f,2)+Math.pow(t,2))+.21)*I);else if(1==Q)c=parseInt((f+.21052631578)*I);else if(2==Q)c=parseInt((t+.21052631578)*I);else if(3==Q)c=parseInt((ja[a]-.75)*I);else if(4==Q)c=parseInt((qa[a]+.25196850393)*I);else if(5==Q)continue;c>=I?c=I-1:0>c&&(c=0);a=Da[c];for(c=d*l;c<(d+1)*l;c++)for(f=b*l;f<(b+1)*l;f++)t=4*(f+c*Ea),N[t+0]=a.r,N[t+1]=a.g,N[t+2]=a.b,N[t+3]=a.a}ta.putImageData(U,
0,0)}function ua(){q.clearRect(0,0,w,z);F.clearRect(0,0,w,z);ta.clearRect(0,0,w,z);H.clearRect(0,0,w,z);Ca();T=!1}function Fa(b){function d(a){var b=a.hasOwnProperty("offsetX")?a.offsetX:a.layerX;a=a.hasOwnProperty("offsetY")?a.offsetY:a.layerY;var d=(b-c)/l/la,e=(a-f)/l/la;.1<Math.abs(d)&&(d=.1*Math.abs(d)/d);.1<Math.abs(e)&&(e=.1*Math.abs(e)/e);for(var h=Math.floor(b/l),m=Math.floor(a/l),k=-5;5>=k;k++)for(var v=-5;5>=v;v++)if(0<=h+k&&h+k<p&&0<=m+v&&m+v<D&&!E[(m+v)*p+(h+k)]&&5>Math.sqrt(k*k+v*v)){var g=
(m+v)*p+(h+k),r=d,n=e,x=ja[g],q=3*r,C=3*-n,w=r*r,z=-n*-n,r=2*r*-n,n=w+z,y=1.5*n;ga[g]=ma*x*(1-y);V[g]=B*x*(1+q+4.5*w-y);W[g]=B*x*(1+C+4.5*z-y);X[g]=B*x*(1-q+4.5*w-y);Y[g]=B*x*(1-C+4.5*z-y);Z[g]=G*x*(1+q+C+4.5*(n+r)-y);aa[g]=G*x*(1-q+C+4.5*(n-r)-y);ba[g]=G*x*(1-q-C+4.5*(n+r)-y);ca[g]=G*x*(1+q-C+4.5*(n-r)-y)}c=b;f=a}function a(b){h.removeEventListener("mousemove",d,!1);h.removeEventListener("mouseup",a,!1);h.removeEventListener("touchmove",d,!1);document.body.removeEventListener("touchend",a,!1)}if(1===
(b.which||b.button)&&S){var c=b.hasOwnProperty("offsetX")?b.offsetX:b.layerX,f=b.hasOwnProperty("offsetY")?b.offsetY:b.layerY;h.addEventListener("mousemove",d,!1);h.addEventListener("mouseup",a,!1);h.addEventListener("touchmove",d,!1);document.body.addEventListener("touchend",a,!1)}}var h=document.getElementById(J.boltzId),Ga=document.getElementById(J.vectorcanvasId),Ha=document.getElementById(J.particlecanvasId),Ia=document.getElementById(J.barriercanvasId),ta=h.getContext("2d"),q=Ga.getContext("2d"),
F=Ha.getContext("2d"),H=Ia.getContext("2d"),p=J.latticeWidth,D=J.latticeHeight,w=h.width,z=h.height,va=.02,e=p*D,ga=new Float64Array(e),V=new Float64Array(e),W=new Float64Array(e),X=new Float64Array(e),Y=new Float64Array(e),Z=new Float64Array(e),aa=new Float64Array(e),ba=new Float64Array(e),ca=new Float64Array(e),ja=new Float64Array(e),ha=new Float64Array(e),ia=new Float64Array(e),E=new Uint8Array(e),qa=new Float64Array(e),P=1/(3*va+.5),Q=0,M=!1,T=!0,L=[],pa=0,S=null,la=10,l=Math.floor(h.width/p),
ma=4/9,B=1/9,G=1/36,U,N,Ea,Da=[],I=400;q.strokeStyle="red";q.fillStyle="red";F.strokeStyle="black";F.fillStyle="black";H.fillStyle="yellow";U=ta.createImageData(w,z);N=U.data;Ea=U.width;(function(b){for(var d=0;d<b;d++){var a=Da,c=d,f=0-b/(d-b),e=1-f,h=f/2,l=f=void 0,u=void 0,u=.5>h?2*h:h+1-1*h,h=2*h-u,f=sa(h,u,e+1/3),l=sa(h,u,e),u=sa(h,u,e-1/3);a[c]={r:Math.round(255*f),g:Math.round(255*l),b:Math.round(255*u),a:255}}})(I);var wa,xa,ya;h.addEventListener("mousedown",Fa,!1);h.addEventListener("touchstart",
Fa,!1);h.addEventListener("contextmenu",function(b){function d(a){c=a.hasOwnProperty("offsetX")?a.offsetX:a.layerX;f=a.hasOwnProperty("offsetY")?a.offsetY:a.layerY;e=Math.floor(c/l);q=Math.floor(f/l);E[q*p+e]=w;T=!0;S||ra()}function a(b){h.removeEventListener("mousemove",d,!1);h.removeEventListener("mouseup",a,!1);h.removeEventListener("touchmove",d,!1);document.body.removeEventListener("touchend",a,!1)}b.preventDefault();var c=b.hasOwnProperty("offsetX")?b.offsetX:b.layerX,f=b.hasOwnProperty("offsetY")?
b.offsetY:b.layerY,e=Math.floor(c/l),q=Math.floor(f/l),w;b=q*p+e;w=E[b]^=1;h.addEventListener("mousemove",d,!1);h.addEventListener("mouseup",a,!1);h.addEventListener("touchmove",d,!1);document.body.addEventListener("touchend",a,!1)},!1);document.getElementById("drawmode").addEventListener("change",function(b){Q=this.selectedIndex;5==Q&&ua()},!1);document.getElementById("viscosity").addEventListener("input",function(b){va=parseInt(this.value,10)/100;P=1/(3*va+.5)},!1);document.getElementById("speed").addEventListener("input",
function(b){la=parseInt(this.value,10)},!1);xa=document.getElementById("flowvectors");xa.addEventListener("click",function(b){this.checked?M=!0:(M=!1,q.clearRect(0,0,w,z))},!1);ya=document.getElementById("flowparticles");ya.addEventListener("click",function(b){if(this.checked)for(L.length=0,b=1;8>b;b++)for(var d=1;20>d;d++)E[10*b*p+10*d]||L.push({x:10*d,y:10*b});else L.length=0,F.clearRect(0,0,w,z)},!1);wa=document.getElementById("play");wa.addEventListener("click",function(b){S?(window.cancelAnimationFrame(S),
S=null,this.innerHTML="Start"):(Aa(),this.innerHTML="Pause")},!1);document.getElementById("reset").addEventListener("click",function(b){window.cancelAnimationFrame(S);S=null;wa.innerHTML="Start";M=!1;L.length=0;xa.checked=!1;ya.checked=!1;Ba();ua()},!1);document.getElementById("clearbarriers").addEventListener("click",function(b){za([]);ua()},!1);document.getElementById("flow-speed").addEventListener("input",function(b){pa=parseInt(this.value,10)/833},!1);Ba()};
